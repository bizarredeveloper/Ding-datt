<!-- Group member view list page -->
<?php
$assets_path = "assets/inner/";
if (Session::has('contest_id')) {
    $contest_id = Session::get('contest_id');
}
?>

<?php $__env->startSection('includes'); ?>   
<link rel="stylesheet" media="all" type="text/css" href="<?php echo URL::to('assets/inner/css/jquery-ui.css'); ?>" />

<script src="<?php echo URL::to('assets/inner/js/jquery-ui.js'); ?>"></script>

<script type="text/javascript" src="<?php echo URL::to('assets/inner/js/jquery-ui-sliderAccess.js'); ?>"></script>

<link type="text/css" rel="stylesheet" href="<?php echo URL::to('assets/inner/js/datatbl/demo_table.css'); ?>">
<script type="text/javascript" src="<?php echo URL::to('assets/inner/js/datatbl/jquery.js'); ?>"></script>
<script type="text/javascript" src="<?php echo URL::to('assets/inner/js/datatbl/jquery.dataTables.js'); ?>"></script>

<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
<script type="text/javascript">stLight.options({publisher: "d4ab7898-2b6c-4cc4-a753-12192e1bb354", shorten: false, doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

<script>
    stWidget.addEntry({
        "service": "sharethis",
        "element": document.getElementById('button_1'),
        "url": "http://sharethis.com",
        "title": "sharethis",
        "type": "large",
        "text": "ShareThis",
        "image": "http://www.softicons.com/download/internet-icons/social-superheros-icons-by-iconshock/png/256/sharethis_hulk.png",
        "summary": "this is description1"
    });
</script>

<style>
</style>
<script type="text/javascript">
    $(document).ready(function () {

        jQuery('#dd_group_list').dataTable({
            "bPaginate": true,
            "sPaginationType": "full_numbers",
            "iDisplayLength": 10,
            "sPageButton": "paginate_button",
            /* 'aoColumnDefs': [{
                    'bSortable': false,
                    'aTargets': [0] 
                }] */
        });


        jQuery('.delete-link').live('click', function (event) {
            if (confirm('Are you sure to delete?'))
            {
                jQuery.ajax({
                    type: 'POST',
                    url: jQuery(this).attr('href'),
                    data: "id=" + jQuery(this).attr('id') + "&action=DELETE",
                    success: function (msg)
                    {
                        if (msg == 1) {
                            alert('Successfully deleted');
                            window.location.reload(true);
                        }
                        else if (msg == 0) {
                            alert("This member booked the class. So not able to delete member.");
                            return false;
                        }
                    }
                });
            }
            event.preventDefault();
        });

        jQuery('.checkall').click(function (event) {


            var contest_id = '<?php echo $contest_id; ?>';
            var groupid = '<?php echo $group_id; ?>';
            var groupmemberids = [];
            if (jQuery(this).is(':checked')) {
                jQuery('.checkseparate').prop('checked', true);
                /// Invite All /////

                jQuery('.checkseparate').each(function (index, element) {
                    if (jQuery(this).is(':checked')) {
                        groupmemberids.push(jQuery(this).val());
                        jQuery('.invitetype_' + jQuery(this).val()).html('Proccessing');
                        $(".invitetype_" + jQuery(this).val()).css('color', 'blue');

                    }
                });
                var dataString = 'groupid=' + groupid + "&contest_id=" + contest_id + "&checkseparate=" + groupmemberids + "&invitetype=all";
                $.ajax({
                    type: "GET",
                    url: 'invitegroupmemberforcontest',
                    data: dataString,
                    success: function (data) {
                        console.log(data);
                        if (data == 1)
                        {
                            $(".invitetypeall").css('color', 'red');
                            $(".invitetypeall").html("Invited");
                            $("#inv_success").html("Invited successfully");
                        }
                    }
                });


                //console.log(groupmemberids);

            } else {

                jQuery('.checkseparate').prop('checked', false);
                /// Univite All /////
                jQuery('.checkseparate').each(function (index, element) {
                    groupmemberids.push(jQuery(this).val());
                });  //console.log(groupmemberids);

                //	window.location = "<?php echo url(); ?>/uninviteallgroupmemberforcontest?groupid="+groupid+"&checkseparate="+groupmemberids+"&contest_id="+contest_id;

                var dataString = 'groupid=' + groupid + "&contest_id=" + contest_id + "&checkseparate=" + groupmemberids + "&uninvitetype=all";
                $.ajax({
                    type: "GET",
                    url: 'uninviteallgroupmemberforcontest',
                    data: dataString,
                    success: function (data) {
                        console.log(data);
                        if (data == 1)
                        {
                            $(".invitetypeall").css('color', 'green');
                            $(".invitetypeall").html("Invite");
                            $("#inv_success").html("Uninvited successfully");
                        }
                    }
                });

            }


        });

        jQuery('.checkseparate').click(function (event) {

            var contest_id = '<?php echo $contest_id; ?>';
            var groupid = '<?php echo $group_id; ?>';
            var checkseparate = jQuery(this).val();


            jQuery('.invitetype_' + checkseparate).html('Proccessing');
            $(".invitetype_" + checkseparate).css('color', 'blue');
            //groupid,contest_id,checkseparate

            if (jQuery(this).is(':checked')) {

                var dataString = 'groupid=' + groupid + "&contest_id=" + contest_id + "&checkseparate=" + checkseparate + "&invitetype=seperate";
                $.ajax({
                    type: "GET",
                    url: 'invitegroupmemberforcontest',
                    data: dataString,
                    success: function (data) {
                        console.log(data);
                        if (data == 1)
                        {
                            $(".invitetype_" + checkseparate).css('color', 'red');
                            $(".invitetype_" + checkseparate).html("Invited");
                            $("#inv_success").html("Invited successfully");
                        }
                    }
                });


                //window.location = "<?php echo url(); ?>/invitegroupmemberforcontest?groupid="+groupid+"&checkseparate="+checkseparate+"&contest_id="+contest_id;	

            } else {
                /// Uninvite process ////

                var dataString = 'group_id=' + groupid + "&contest_id=" + contest_id + "&groupmemberid=" + checkseparate;
                $.ajax({
                    type: "GET",
                    url: 'uninvite_group_member',
                    data: dataString,
                    success: function (data) {
                        console.log(data);
                        if (data == 1)
                        {

                            $(".invitetype_" + checkseparate).html("Invite");
                            $(".invitetype_" + checkseparate).css('color', 'green');
                            $("#inv_success").html("Uninvited successfully");
                        }
                    }
                });
            }

        });

        //// For pagination /////
        $(".paginate_button").click(function () {
            jQuery('.checkseparate').click(function (event) {

                var contest_id = '<?php echo $contest_id; ?>';
                var groupid = '<?php echo $group_id; ?>';
                var checkseparate = jQuery(this).val();


                jQuery('.invitetype_' + checkseparate).html('Proccessing');
                $(".invitetype_" + checkseparate).css('color', 'blue');
                //groupid,contest_id,checkseparate

                if (jQuery(this).is(':checked')) {

                    var dataString = 'groupid=' + groupid + "&contest_id=" + contest_id + "&checkseparate=" + checkseparate + "&invitetype=seperate";
                    $.ajax({
                        type: "GET",
                        url: 'invitegroupmemberforcontest',
                        data: dataString,
                        success: function (data) {
                            console.log(data);
                            if (data == 1)
                            {
                                $(".invitetype_" + checkseparate).css('color', 'red');
                                $(".invitetype_" + checkseparate).html("Invited");
                                $("#inv_success").html("Invited successfully");
                            }
                        }
                    });


                    //window.location = "<?php echo url(); ?>/invitegroupmemberforcontest?groupid="+groupid+"&checkseparate="+checkseparate+"&contest_id="+contest_id;	

                } else {
                    /// Uninvite process ////

                    var dataString = 'group_id=' + groupid + "&contest_id=" + contest_id + "&groupmemberid=" + checkseparate;
                    $.ajax({
                        type: "GET",
                        url: 'uninvite_group_member',
                        data: dataString,
                        success: function (data) {
                            console.log(data);
                            if (data == 1)
                            {

                                $(".invitetype_" + checkseparate).html("Invite");
                                $(".invitetype_" + checkseparate).css('color', 'green');
                                $("#inv_success").html("Uninvited successfully");
                            }
                        }
                    });
                }

            });


        });

    });

    function groupmrmbrdelete(groupmemberid, group_id)
    {
        var answer = confirm('Are you sure you want to remove?');
        if (answer)
        {
            window.location = "<?php echo url(); ?>/groupmemberdelete?groupmemberid=" + groupmemberid + "&group_id=" + group_id;

        }
    }

    function invitegroupmember(groupid)
    {

        if (jQuery('.checkseparate:checked').length > 0)
        {
            var checkseparate = [];
            jQuery('.checkseparate').each(function (index, element) {
                if (jQuery(this).is(':checked')) {
                    checkseparate.push(jQuery(this).val());
                }
            });
            var contest_id = '<?php echo $contest_id; ?>';
            //alert(contest_id);
            window.location = "<?php echo url(); ?>/invitegroupmemberforcontest?groupid=" + groupid + "&checkseparate=" + checkseparate + "&contest_id=" + contest_id;

        }
        else {
            alert("Choose member for invite");
        }
    }


    function uninviteallgroupmember(groupid)
    {

        if (jQuery('.checkseparate:checked').length > 0)
        {
            var checkseparate = [];
            jQuery('.checkseparate').each(function (index, element) {
                if (jQuery(this).is(':checked')) {
                    checkseparate.push(jQuery(this).val());
                }
            });
            var contest_id = '<?php echo $contest_id; ?>';

            window.location = "<?php echo url(); ?>/uninviteallgroupmemberforcontest?groupid=" + groupid + "&checkseparate=" + checkseparate + "&contest_id=" + contest_id;

        }
        else {
            alert("Choose member for Uninvite");
        }
    }





</script>
<?php $__env->stopSection(); ?>
<?php $__env->startSection('body'); ?>
<?php echo Form::hidden('pagename','groupmember', array('id'=> 'pagename')); ?>

<?php
if (Session::has('er_data')) {
    $er_data = Session::get('er_data');

}

if (Session::has('Message')) {
    $Message = Session::get('Message');
}
?>
<div class="tabs-wrapper">
    <input type="radio" name="tab" id="tab1" class="tab-head" checked="checked"/>
    <label for="tab1"><span id="txt_groupmember">Group Member</span></label>

	<a href="<?php echo url(); ?>/groupmemberback?group_id=<?php echo $group_id; ?>&contest_id=<?php echo $contest_id; ?>">
    <div id="subtab_div" class="con_cat_right mbnone" >
        <button class="bck_btn" >&laquo; <span class="txt_back" > Back </span> </button>
    </div>
	</a>

    <div class="tab-body-wrapper">
        <div id="tab-body-1" class="tab-body">
            <?php if(isset($er_data['memberdelete'])): ?>
            <p class="alert" style="color:red; font-size:13px;"><?php echo $er_data['memberdelete']; ?></p>
            <?php endif; ?>
            <?php if(isset($er_data['message'])): ?>
            <p class="alert" style="color:red; font-size:13px;"><?php echo $er_data['message']; ?></p>
            <?php endif; ?>
            <?php if(isset($Message)): ?>
            <p class="alert" style="color:red; font-size:13px;"><?php echo $Message; ?></p>
            <?php endif; ?>
            <span id="inv_success" class="alert" style="color:green; font-size:13px;"></span>
            <div id="p">
<?php $d = groupModel::select('groupname', 'createdby', 'ID')->where('ID', $group_id)->get(); ?>
                <h1><?php echo $d[0]['groupname']; ?></h1>
                <div class="fleft mb_brk">
<?php $membercount = groupmemberModel::where('group_id', $group_id)->where('user_id', Auth::user()->ID)->get()->count();
?>
                    <nav class="slidernav">
                        <div id="navbtns" class="clearfix" ><b>
<?php if ($showjoinbtn != 'no') { ?>
                        <?php if ($membercount != 1) { ?><a href="<?php echo url(); ?>/joinintogroup/<?php echo $group_id; ?>"><span class="txt_join">Join</span></a><?php } ?>
                        <?php if ($d[0]['createdby'] == Auth::user()->ID || Auth::user()->ID == 1) { ?><a href="<?php echo url(); ?>/addmembertogroup/<?php echo $group_id; ?>"><span class="btn_addmember">Add Member</span></a><?php } ?>
                    <?php } ?></b>
                        </div>
                    </nav> 
                </div>

                                <?php
                                if ($showjoinbtn != 'no') {
                                    //if(Auth::user()->ID==$d[0]['createdby']) { 
                                    ?>

                    <meta property="og:title" content="DingDatt - Invitation for Group"/>
                    <meta property="og:type" content="website"/>
                    <meta property="og:url" content="<?php echo Request::url(); ?>"/>
                    <meta property="og:image" content="<?php echo URL::to('assets/inner/img/DingDatt_logo_web1.png'); ?>"/>
                    <!--<meta property="og:description" content="<?php echo 'Group name: '.$d[0]['groupname']; ?>"/>-->

                    <meta property="og:description" content="<?php echo URL::to('sharegroup/'.$d[0]['ID']); ?>"/>

                    <div class="fright mb_brk" style="font: normal 13px/20px Arial, Helvetica, sans-serif;">Share with
                        <span class='st_facebook_large' ></span>
                        <span class='st_twitter_large' ></span>
                        <span class='st_tumblr_large' ></span>					
                        <span class='st_email_large'  ></span>
                        <span class='st_googleplus_large'></span>
                        <span class='st_instagram_large'></span>
                        <span class='st_pinterest_large'></span>

                    </div>
    <?php //}
}
?>



                <table class="display" cellspacing="0" width="100%" id="dd_group_list">
                    <thead>
                        <tr>
                <?php
                if ($showjoinbtn == 'no') {

					$groupmemberlistnew = groupmemberModel::where('group_id', $group_id)->lists('user_id');
				  	$invitednew = invitegroupforcontestModel::whereIn('user_id', $groupmemberlistnew)->where('contest_id', $contest_id)->count();

                    ?><th style="background-color:#0896D6"><input type="checkbox" name="checkall" class="checkall" <?php if ($invitednew + 1 == count($groupmemberlistnew) && count($groupmemberlistnew) != 1) echo "checked"; ?> /></th> <?php } ?>
                           
                            <th><span class="txt_img">Image</span></th>
                            <th><span class="txt_memname">Member Name</span></th> 
                            <?php if ($showjoinbtn == 'no') { ?><th>Invite/Uninvite</th> <?php } ?>
							<th> Email  </th>
							<th style="width:10%"> Interest</th>
							<th> Social Media </th>
                            <?php if ($showjoinbtn != 'no') { ?><th class="tr_wid_button1" align="center"><span class="txt_remove">Remove / Exit</span></th><?php } ?>
                            <?php if ($showjoinbtn != 'no') { ?><?php } ?>
                            <th class="tr_wid_button1" align="center"><span class="txt_view">View</span></th>
                        </tr>
                    </thead>
                    <tbody>
                            <?php
                            $savegroupmembers = groupmemberModel::select('group_members.id as groupmemberid', 'group_members.user_id', 'user.firstname', 'user.lastname', 'user.username', 'user.profilepicture','user.email', 'group.createdby as groupadmin_userid', 'user.ID as usrid','user.facebookpage','user.twitterpage','user.instagrampage')
                                            ->LeftJoin('user', 'user.ID', '=', 'group_members.user_id')
                                            ->where('group_id', $group_id)->where('user.status', 1)
                                            ->LeftJoin('group', 'group.ID', '=', 'group_members.group_id')
                                            ->orderby('group_members.id')->get();

                            if ($showjoinbtn == 'no') {
                                $contestdetails = contestModel::where('ID', $contest_id)->get()->first();
                            }


                            for ($i = 0; $i < count($savegroupmembers); $i++) {
                                ?>
                            <?php
                            if ($showjoinbtn == 'no') {
                                $invited = invitegroupforcontestModel::where('contest_id', $contest_id)->where('user_id', $savegroupmembers[$i]['user_id'])->count();
                                ?> <td><?php if ($contestdetails['createdby'] != $savegroupmembers[$i]['user_id'] && $savegroupmembers[$i]['user_id'] != 1) { ?> <input type="checkbox" name="checkseparate" class="checkseparate" <?php if ($invited > 0) {
                            echo "checked";
                        } ?> value="<?php echo $savegroupmembers[$i]['groupmemberid']; ?>" /><?php } ?></td> 
                            <?php }
							
							
                            ?>
                         <?php  
						
						$userinteresr = userinterestModel::where('user_interest.user_id',$savegroupmembers[$i]['user_id'])->LeftJoin('interest_category','interest_category.Interest_id','=','user_interest.interest_id')->lists('interest_category.Interest_name'); 
												
						
						?> 
                        <td align="center"><img src="<?php echo ($savegroupmembers[$i]['profilepicture']!='')?(URL::to('public/assets/upload/profile/'.$savegroupmembers[$i]['profilepicture'])):(URL::to('assets/inner/images/avator.png')); ?>" width="50" height="50"></td>
                        <td class="tr_wid_id"><?php
                            if ($savegroupmembers[$i]['firstname'] != '') {
                                echo $savegroupmembers[$i]['firstname'] . ' ' . $savegroupmembers[$i]['lastname'];
                            } else {
                                echo $savegroupmembers[$i]['username'];
                            }
                            if ($savegroupmembers[$i]['usrid'] == $savegroupmembers[$i]['groupadmin_userid'])
                                echo '<font class="alert" style="color:green;"> (Group owner)</font>';
                            ?></td> 
                            <?php if ($showjoinbtn == 'no') { ?><td <?php if ($contestdetails['createdby'] != $savegroupmembers[$i]['user_id']) { ?> class="invitetype_<?php echo $savegroupmembers[$i]['groupmemberid']; ?> invitetypeall" id="invitetype" <?php } ?>> 

                                <?php 
								//$contestdetails['createdby'] != 1 
								if ($contestdetails['createdby'] != $savegroupmembers[$i]['user_id'] && $savegroupmembers[$i]['user_id'] != 1) {
                                    if ($invited > 0) {
                                        echo "<font style='color:red;' id='yy' class='asas' >Invited</font>";
                                    } else {
                                        echo "<font style='color:green;' id='yy' class='asas' >Invite</font>";
                                    } 
                                } ?>

                            </td> <?php } ?>
							<td> <?php echo $savegroupmembers[$i]['email']; ?>  </td>
							<td> <?php  echo implode($userinteresr,','); ?></td>
							<td >
							
							<?php if($savegroupmembers[$i]['facebookpage']!=''){ 
							
							if (!preg_match("~^(?:f|ht)tps?://~i", $savegroupmembers[$i]['facebookpage'])) {
							$facurl = "https://" . $savegroupmembers[$i]['facebookpage'];
							} else { $facurl = $savegroupmembers[$i]['facebookpage']; }
							
							?>
							
							 <a href="<?php echo $facurl; ?>" target="_blank">
							<img src="<?php echo URL::to('/assets/inner/img/facebook_icons.png'); ?>" width="25" height="25"  style="background:#000000;"> 
							</a> 
							<?php } if($savegroupmembers[$i]['twitterpage']!=''){ 
							
							if (!preg_match("~^(?:f|ht)tps?://~i", $savegroupmembers[$i]['twitterpage'])) {
							$twiturl = "https://" . $savegroupmembers[$i]['twitterpage'];
							} else { $twiturl = $savegroupmembers[$i]['twitterpage']; }
							?>
							
							
							<a href="<?php echo $twiturl; ?>" target="_blank">
							<img src="<?php echo URL::to('/assets/inner/img/twitter_icons.png'); ?>" width="25" height="25" style="background:#000000;">
							</a> 
							
							<?php } if($savegroupmembers[$i]['instagrampage']!=''){ 
							
							if (!preg_match("~^(?:f|ht)tps?://~i", $savegroupmembers[$i]['instagrampage'])) {
							$insturl = "https://" . $savegroupmembers[$i]['instagrampage'];
							} else { $insturl = $savegroupmembers[$i]['instagrampage']; }
							
							?>
							<a href="<?php echo $insturl; ?>" target="_blank">
							<img src="<?php echo URL::to('/assets/inner/img/instagram_icons.png'); ?>" width="25" height="25"  style="background:#000000;">
							</a>
							<?php } ?>
							</td>
                    <?php if ($showjoinbtn != 'no') { ?> <td class="tr_wid_button1" align="center"><?php if (Auth::user()->ID == $savegroupmembers[$i]['groupadmin_userid'] && Auth::user()->ID != $savegroupmembers[$i]['user_id'] || Auth::user()->ID == 1 && $savegroupmembers[$i]['usrid'] != $savegroupmembers[$i]['groupadmin_userid']) { ?><a href="#" onclick="groupmrmbrdelete('<?php echo $savegroupmembers[$i]['groupmemberid']; ?>', '<?php echo $group_id; ?>')" class="remove-link"></a><?php } ?></td><?php } ?>

    <?php if ($showjoinbtn != 'no') { ?><?php } ?>
                        <td align="center"><a href="<?php echo url(); ?>/other_profile/<?php echo $savegroupmembers[$i]['user_id']; ?>" class="view-link"></a></td>
                        </tr>
<?php } ?>
                    </tbody>
                </table>
<?php if ($showjoinbtn == 'no') {
    
} ?>
            </div>
        </div>
    </div>
</div>
<div class="clrscr"></div>
</div>
<?php $__env->stopSection(); ?>
<?php echo $__env->make('header.header', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>